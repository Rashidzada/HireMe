{% extends "base.html" %}
{% load static %}

{% block content %}
  <div class="card p-4" id="chat-root" data-thread-id="{{ thread.pk }}" data-user-id="{{ user.pk }}">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h5 mb-0">Chat with {{ other_user.full_name }}</h1>
        <small class="text-muted">Request: {{ thread.hire_request.subject }}</small>
      </div>
    </div>
    <div id="chat-log" class="border rounded p-3 mb-3 bg-white" style="height: 320px; overflow-y: auto;">
      {% for msg in messages %}
        <div class="d-flex {% if msg.sender == user %}justify-content-end{% else %}justify-content-start{% endif %} mb-2">
          <div class="p-2 rounded {% if msg.sender == user %}bg-primary text-white{% else %}bg-light{% endif %}" style="max-width: 75%;">
            <div class="small fw-semibold">{{ msg.sender.full_name }}</div>
            <div>{{ msg.body }}</div>
          </div>
        </div>
      {% empty %}
        <p class="text-muted">No messages yet.</p>
      {% endfor %}
    </div>
    <form id="chat-form" method="post" action="{% url 'messaging:post-message' thread.pk %}">
      {% csrf_token %}
      <div class="input-group">
        <input type="text" class="form-control" id="chat-message-input" name="body" placeholder="Type a message...">
        <button class="btn btn-primary" type="submit">Send</button>
      </div>
    </form>
  </div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/chat.js' %}"></script>
{% endblock %}
